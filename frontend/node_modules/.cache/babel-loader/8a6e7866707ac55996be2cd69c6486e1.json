{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ederivc\\\\Documents\\\\PuppyVeterinarySystem\\\\frontend\\\\src\\\\pages\\\\CartPage\\\\CartPage.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useContext, useEffect, useState } from \"react\";\nimport { APIPedidos, IMG_URL } from \"../../api/api\";\nimport useAuth from \"../../auth/useAuth\";\nimport { CartContext } from \"../../layouts/Layout\";\nimport { Alert, Container } from \"react-bootstrap\";\nimport styles from \"./CartPage.module.css\";\nimport { validateEmail } from \"../../components/Validations\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst CartPage = () => {\n  _s();\n\n  var _user$first_name, _user$last_name, _user$phone, _user$email;\n\n  const {\n    cart,\n    setCart,\n    addedProduct,\n    setAddedProduct,\n    cartTotal,\n    cartRef,\n    setCartTotal,\n    clearCartInputs\n  } = useContext(CartContext);\n  const {\n    user\n  } = useAuth();\n  const [hasLoaded, setHasLoaded] = useState(false);\n  const [userForm, setUserForm] = useState({\n    nombre: (_user$first_name = user === null || user === void 0 ? void 0 : user.first_name) !== null && _user$first_name !== void 0 ? _user$first_name : \"\",\n    apellido: (_user$last_name = user === null || user === void 0 ? void 0 : user.last_name) !== null && _user$last_name !== void 0 ? _user$last_name : \"\",\n    telefono: (_user$phone = user === null || user === void 0 ? void 0 : user.phone) !== null && _user$phone !== void 0 ? _user$phone : \"\",\n    email: (_user$email = user === null || user === void 0 ? void 0 : user.email) !== null && _user$email !== void 0 ? _user$email : \"\",\n    direccion: \"\",\n    codigoPostal: \"\"\n  });\n  const [alert, setAlert] = useState();\n  const [alertMsg, setAlertMsg] = useState();\n  const [alertVariant, setAlertVariant] = useState();\n\n  const handleChange = e => {\n    setUserForm({ ...userForm,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  const handleAlert = (msg, variant) => {\n    setAlert(true);\n    setAlertMsg(msg);\n    setAlertVariant(variant);\n    setTimeout(() => {\n      setAlert(false);\n      setAlertMsg(\"\");\n      setAlertVariant(\"\");\n    }, 2000);\n  };\n\n  const arrayMove = (arr, fromIndex, toIndex) => {\n    const element = arr[fromIndex];\n    arr.splice(fromIndex, 1);\n    arr.splice(toIndex, 0, element);\n  };\n\n  const addProduct = (product, oldIndex) => {\n    setHasLoaded(false);\n    const filteredProduct = cartRef.current.filter(item => item.product_id === product.product_id);\n    filteredProduct[0].totalNum += 1;\n    const filteredProducts = getArrayItems(product);\n    setObjectValues(filteredProducts, filteredProduct, oldIndex);\n    setCart(cart + 1);\n    setCartTotal(cartTotal + product.price);\n    setHasLoaded(true);\n  };\n\n  const setObjectValues = (filteredProducts, filteredProduct, oldIndex) => {\n    Array.prototype.push.apply(filteredProducts, filteredProduct);\n    const newIndex = filteredProducts.length - 1;\n    arrayMove(filteredProducts, newIndex, oldIndex);\n    cartRef.current = filteredProducts;\n    setAddedProduct(filteredProducts);\n  };\n\n  const getArrayItems = product => {\n    const filteredProducts = cartRef.current.filter(item => item.product_id !== product.product_id);\n    return filteredProducts;\n  };\n\n  const deleteProduct = (product, oldIndex) => {\n    setHasLoaded(false);\n    const filteredProduct = cartRef.current.filter(item => item.product_id === product.product_id);\n\n    if (filteredProduct[0].totalNum > 0) {\n      filteredProduct[0].totalNum -= 1;\n      const filteredProducts = getArrayItems(product);\n      setObjectValues(filteredProducts, filteredProduct, oldIndex);\n      setCart(cart - 1);\n      setCartTotal(cartTotal - product.price);\n      setHasLoaded(true);\n    }\n\n    if (filteredProduct[0].totalNum <= 0) {\n      cartRef.current.splice(oldIndex, 1);\n      setHasLoaded(true);\n    }\n  };\n\n  const clearInputs = () => {\n    var _user$first_name2, _user$last_name2, _user$phone2, _user$email2;\n\n    setUserForm({\n      nombre: (_user$first_name2 = user === null || user === void 0 ? void 0 : user.first_name) !== null && _user$first_name2 !== void 0 ? _user$first_name2 : \"\",\n      apellido: (_user$last_name2 = user === null || user === void 0 ? void 0 : user.last_name) !== null && _user$last_name2 !== void 0 ? _user$last_name2 : \"\",\n      telefono: (_user$phone2 = user === null || user === void 0 ? void 0 : user.phone) !== null && _user$phone2 !== void 0 ? _user$phone2 : \"\",\n      email: (_user$email2 = user === null || user === void 0 ? void 0 : user.email) !== null && _user$email2 !== void 0 ? _user$email2 : \"\",\n      direccion: \"\",\n      codigoPostal: \"\"\n    });\n    setAddedProduct([]);\n    cartRef.current = addedProduct;\n    setCart(0);\n    setCartTotal(0);\n  };\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    let validate = 0;\n    Object.entries(userForm).forEach(([key, value]) => {\n      if (value === \"\" || value.trim() === \"\") {\n        handleAlert(\"No puedes dejar espacios en blanco\", \"danger\");\n        validate = 1;\n        return;\n      }\n\n      if (key === \"telefono\") {\n        if (isNaN(userForm[\"telefono\"]) || userForm[\"telefono\"].length !== 10) {\n          handleAlert(\"El teléfono está incorrecto, debe ser un número de 10 caracteres\", \"danger\");\n          validate = 1;\n          return;\n        }\n      }\n\n      if (key === \"codigoPostal\") {\n        if (isNaN(userForm[\"codigoPostal\"] || userForm[\"codigoPostal\"].length !== 5)) {\n          handleAlert(\"Código postal incorrecto, deber ser un número de 5 caracteres\", \"danger\");\n          validate = 1;\n          return;\n        }\n      }\n\n      if (key === \"email\") {\n        if (!validateEmail(userForm[\"email\"])) {\n          handleAlert(\"El formato del email no es correcto\", \"danger\");\n          validate = 1;\n          return;\n        }\n      }\n    });\n\n    if (validate === 0) {\n      const data = { ...userForm,\n        Pedidos: cartRef.current,\n        Total: cartTotal\n      };\n      const res = await APIPedidos.createPedido({\n        data\n      });\n\n      if (res[1].status === 400) {\n        handleAlert(res[0][\"message\"], \"danger\");\n      } else {\n        clearCartInputs();\n        handleAlert(res[0][\"Response\"], \"success\");\n      }\n    }\n  };\n\n  useEffect(() => {\n    addedProduct.forEach(value => {\n      const productId = value.product_id;\n      let totalNum = 0;\n      addedProduct.forEach(actualProduct => {\n        if (actualProduct.product_id === productId) {\n          if (actualProduct.hasOwnProperty(\"totalNum\")) {\n            totalNum = actualProduct.totalNum;\n          } else {\n            totalNum += 1;\n          }\n        }\n      });\n      value.totalNum = totalNum;\n    });\n    const unique = [...new Map(addedProduct.map(item => [item[\"product_id\"], item])).values()];\n    cartRef.current = unique;\n    setHasLoaded(true);\n  }, [addedProduct, cartRef]);\n  return /*#__PURE__*/_jsxDEV(Container, {\n    className: styles.cartContainer,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"py-5 text-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        className: \"d-block mx-auto mb-5\",\n        src: \"https://image.flaticon.com/icons/png/512/3594/3594363.png\",\n        alt: \"\",\n        width: \"72\",\n        height: \"72\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Carrito de Compras\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"lead\",\n        children: \"Para proceder con su compra verifique sus datos y complete los campos vacios. Recibir\\xE1 un correo cuando su pedido haya sido aprobado.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row\",\n      children: [alert ? /*#__PURE__*/_jsxDEV(Alert, {\n        variant: alertVariant,\n        className: \"w-100 mx-auto\",\n        children: alertMsg\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 11\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-4 order-md-2 mb-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          className: \"d-flex justify-content-between align-items-center mb-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-muted\",\n            children: \"Carrito\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"badge badge-secondary badge-pill\",\n            children: cart\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"list-group mb-3\",\n          children: [hasLoaded ? cartRef.current.map(product => {\n            return /*#__PURE__*/_jsxDEV(\"li\", {\n              className: \"list-group-item d-flex justify-content-between align-items-center flex-wrap lh-condensed\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.productCont,\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.productInfo,\n                  children: [/*#__PURE__*/_jsxDEV(\"h6\", {\n                    className: \"my-0\",\n                    children: product.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 262,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n                    className: \"text-muted\",\n                    children: product.descripcion\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 263,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 261,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.imgCont,\n                  children: /*#__PURE__*/_jsxDEV(\"img\", {\n                    src: `${IMG_URL}${product.img}`,\n                    alt: \"\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 268,\n                    columnNumber: 27\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 267,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 260,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"d-flex flex-column\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-muted\",\n                  children: [\"$\", product.totalNum * product.price]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 272,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [\"Cantidad: \", product.totalNum]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 275,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.buttons,\n                  children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn btn-success\",\n                    onClick: () => addProduct(product, cartRef.current.indexOf(product)),\n                    children: \"+\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 277,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn btn-danger\",\n                    onClick: () => deleteProduct(product, cartRef.current.indexOf(product)),\n                    children: \"-\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 288,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 276,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 271,\n                columnNumber: 23\n              }, this)]\n            }, product.product_id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 256,\n              columnNumber: 21\n            }, this);\n          }) : null, /*#__PURE__*/_jsxDEV(\"li\", {\n            className: \"list-group-item d-flex justify-content-between\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Total\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 306,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"strong\", {\n              children: `$${cartTotal}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 307,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 305,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-8 order-md-1\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          className: \"mb-3\",\n          children: \"Datos del Usuario\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-md-6 mb-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                for: \"nombre\",\n                children: \"Nombre\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 316,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                className: \"form-control\",\n                id: \"nombre\",\n                name: \"nombre\",\n                placeholder: \"\",\n                value: userForm.nombre,\n                onChange: handleChange,\n                disabled: userForm.email ? true : false\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 317,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 315,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-md-6 mb-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                for: \"apellido\",\n                children: \"Apellidos\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 329,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                className: \"form-control\",\n                id: \"apellido\",\n                name: \"apellido\",\n                placeholder: \"\",\n                value: userForm.apellido,\n                onChange: handleChange,\n                disabled: userForm.email ? true : false\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 330,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 328,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 314,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              for: \"telefono\",\n              children: \"Tel\\xE9fono\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 344,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input-group\",\n              children: /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                className: \"form-control\",\n                id: \"telefono\",\n                name: \"telefono\",\n                placeholder: \"Ejemplo: 4433609253\",\n                value: userForm.telefono,\n                onChange: handleChange\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 346,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 345,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 343,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              for: \"email\",\n              children: \"Email\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 359,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"email\",\n              className: \"form-control\",\n              id: \"email\",\n              name: \"email\",\n              placeholder: \"usuario@ejemplo.com\",\n              value: userForm.email,\n              onChange: handleChange,\n              disabled: userForm.email ? true : false\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 360,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              for: \"direccion\",\n              children: \"Direcci\\xF3n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 373,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              className: \"form-control\",\n              id: \"direccion\",\n              name: \"direccion\",\n              placeholder: \"Direcci\\xF3n\",\n              value: userForm.direccion,\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 374,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 372,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              for: \"codigoPostal\",\n              children: \"C\\xF3digo Postal\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 385,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              class: \"form-control\",\n              id: \"codigoPostal\",\n              name: \"codigoPostal\",\n              placeholder: \"C\\xF3digo Postal\",\n              value: userForm.codigoPostal,\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 386,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 384,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"hr\", {\n            class: \"mb-4\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 396,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            class: \"btn btn-primary btn-lg btn-block\",\n            onClick: handleSubmit,\n            children: \"Realizar Pedido\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 313,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 225,\n    columnNumber: 5\n  }, this);\n};\n\n_s(CartPage, \"OsdV2SsxJnOJcEIpDVYufiJ6dEM=\", false, function () {\n  return [useAuth];\n});\n\n_c = CartPage;\nexport default CartPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"CartPage\");","map":{"version":3,"sources":["C:/Users/ederivc/Documents/PuppyVeterinarySystem/frontend/src/pages/CartPage/CartPage.jsx"],"names":["React","useContext","useEffect","useState","APIPedidos","IMG_URL","useAuth","CartContext","Alert","Container","styles","validateEmail","CartPage","cart","setCart","addedProduct","setAddedProduct","cartTotal","cartRef","setCartTotal","clearCartInputs","user","hasLoaded","setHasLoaded","userForm","setUserForm","nombre","first_name","apellido","last_name","telefono","phone","email","direccion","codigoPostal","alert","setAlert","alertMsg","setAlertMsg","alertVariant","setAlertVariant","handleChange","e","target","name","value","handleAlert","msg","variant","setTimeout","arrayMove","arr","fromIndex","toIndex","element","splice","addProduct","product","oldIndex","filteredProduct","current","filter","item","product_id","totalNum","filteredProducts","getArrayItems","setObjectValues","price","Array","prototype","push","apply","newIndex","length","deleteProduct","clearInputs","handleSubmit","preventDefault","validate","Object","entries","forEach","key","trim","isNaN","data","Pedidos","Total","res","createPedido","status","productId","actualProduct","hasOwnProperty","unique","Map","map","values","cartContainer","productCont","productInfo","descripcion","imgCont","img","buttons","indexOf"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from \"react\";\r\nimport { APIPedidos, IMG_URL } from \"../../api/api\";\r\nimport useAuth from \"../../auth/useAuth\";\r\nimport { CartContext } from \"../../layouts/Layout\";\r\nimport { Alert, Container } from \"react-bootstrap\";\r\nimport styles from \"./CartPage.module.css\";\r\nimport { validateEmail } from \"../../components/Validations\";\r\n\r\nconst CartPage = () => {\r\n  const {\r\n    cart,\r\n    setCart,\r\n    addedProduct,\r\n    setAddedProduct,\r\n    cartTotal,\r\n    cartRef,\r\n    setCartTotal,\r\n    clearCartInputs,\r\n  } = useContext(CartContext);\r\n\r\n  const { user } = useAuth();\r\n  const [hasLoaded, setHasLoaded] = useState(false);\r\n  const [userForm, setUserForm] = useState({\r\n    nombre: user?.first_name ?? \"\",\r\n    apellido: user?.last_name ?? \"\",\r\n    telefono: user?.phone ?? \"\",\r\n    email: user?.email ?? \"\",\r\n    direccion: \"\",\r\n    codigoPostal: \"\",\r\n  });\r\n\r\n  const [alert, setAlert] = useState();\r\n  const [alertMsg, setAlertMsg] = useState();\r\n  const [alertVariant, setAlertVariant] = useState();\r\n\r\n  const handleChange = (e) => {\r\n    setUserForm({\r\n      ...userForm,\r\n      [e.target.name]: e.target.value,\r\n    });\r\n  };\r\n\r\n  const handleAlert = (msg, variant) => {\r\n    setAlert(true);\r\n    setAlertMsg(msg);\r\n    setAlertVariant(variant);\r\n    setTimeout(() => {\r\n      setAlert(false);\r\n      setAlertMsg(\"\");\r\n      setAlertVariant(\"\");\r\n    }, 2000);\r\n  };\r\n\r\n  const arrayMove = (arr, fromIndex, toIndex) => {\r\n    const element = arr[fromIndex];\r\n    arr.splice(fromIndex, 1);\r\n    arr.splice(toIndex, 0, element);\r\n  };\r\n\r\n  const addProduct = (product, oldIndex) => {\r\n    setHasLoaded(false);\r\n    const filteredProduct = cartRef.current.filter(\r\n      (item) => item.product_id === product.product_id\r\n    );\r\n\r\n    filteredProduct[0].totalNum += 1;\r\n\r\n    const filteredProducts = getArrayItems(product);\r\n\r\n    setObjectValues(filteredProducts, filteredProduct, oldIndex);\r\n\r\n    setCart(cart + 1);\r\n    setCartTotal(cartTotal + product.price);\r\n\r\n    setHasLoaded(true);\r\n  };\r\n\r\n  const setObjectValues = (filteredProducts, filteredProduct, oldIndex) => {\r\n    Array.prototype.push.apply(filteredProducts, filteredProduct);\r\n\r\n    const newIndex = filteredProducts.length - 1;\r\n\r\n    arrayMove(filteredProducts, newIndex, oldIndex);\r\n\r\n    cartRef.current = filteredProducts;\r\n    setAddedProduct(filteredProducts);\r\n  };\r\n\r\n  const getArrayItems = (product) => {\r\n    const filteredProducts = cartRef.current.filter(\r\n      (item) => item.product_id !== product.product_id\r\n    );\r\n\r\n    return filteredProducts;\r\n  };\r\n\r\n  const deleteProduct = (product, oldIndex) => {\r\n    setHasLoaded(false);\r\n    const filteredProduct = cartRef.current.filter(\r\n      (item) => item.product_id === product.product_id\r\n    );\r\n\r\n    if (filteredProduct[0].totalNum > 0) {\r\n      filteredProduct[0].totalNum -= 1;\r\n\r\n      const filteredProducts = getArrayItems(product);\r\n\r\n      setObjectValues(filteredProducts, filteredProduct, oldIndex);\r\n\r\n      setCart(cart - 1);\r\n      setCartTotal(cartTotal - product.price);\r\n\r\n      setHasLoaded(true);\r\n    }\r\n\r\n    if (filteredProduct[0].totalNum <= 0) {\r\n      cartRef.current.splice(oldIndex, 1);\r\n      setHasLoaded(true);\r\n    }\r\n  };\r\n\r\n  const clearInputs = () => {\r\n    setUserForm({\r\n      nombre: user?.first_name ?? \"\",\r\n      apellido: user?.last_name ?? \"\",\r\n      telefono: user?.phone ?? \"\",\r\n      email: user?.email ?? \"\",\r\n      direccion: \"\",\r\n      codigoPostal: \"\",\r\n    });\r\n    setAddedProduct([]);\r\n    cartRef.current = addedProduct;\r\n    setCart(0);\r\n    setCartTotal(0);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    let validate = 0;\r\n    Object.entries(userForm).forEach(([key, value]) => {\r\n      if (value === \"\" || value.trim() === \"\") {\r\n        handleAlert(\"No puedes dejar espacios en blanco\", \"danger\");\r\n        validate = 1;\r\n        return;\r\n      }\r\n\r\n      if (key === \"telefono\") {\r\n        if (isNaN(userForm[\"telefono\"]) || userForm[\"telefono\"].length !== 10) {\r\n          handleAlert(\r\n            \"El teléfono está incorrecto, debe ser un número de 10 caracteres\",\r\n            \"danger\"\r\n          );\r\n          validate = 1;\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (key === \"codigoPostal\") {\r\n        if (\r\n          isNaN(\r\n            userForm[\"codigoPostal\"] || userForm[\"codigoPostal\"].length !== 5\r\n          )\r\n        ) {\r\n          handleAlert(\r\n            \"Código postal incorrecto, deber ser un número de 5 caracteres\",\r\n            \"danger\"\r\n          );\r\n          validate = 1;\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (key === \"email\") {\r\n        if (!validateEmail(userForm[\"email\"])) {\r\n          handleAlert(\"El formato del email no es correcto\", \"danger\");\r\n          validate = 1;\r\n          return;\r\n        }\r\n      }\r\n    });\r\n\r\n    if (validate === 0) {\r\n      const data = { ...userForm, Pedidos: cartRef.current, Total: cartTotal };\r\n      const res = await APIPedidos.createPedido({\r\n        data,\r\n      });\r\n      if (res[1].status === 400) {\r\n        handleAlert(res[0][\"message\"], \"danger\");\r\n      } else {\r\n        clearCartInputs();\r\n        handleAlert(res[0][\"Response\"], \"success\");\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    addedProduct.forEach((value) => {\r\n      const productId = value.product_id;\r\n      let totalNum = 0;\r\n\r\n      addedProduct.forEach((actualProduct) => {\r\n        if (actualProduct.product_id === productId) {\r\n          if (actualProduct.hasOwnProperty(\"totalNum\")) {\r\n            totalNum = actualProduct.totalNum;\r\n          } else {\r\n            totalNum += 1;\r\n          }\r\n        }\r\n      });\r\n      value.totalNum = totalNum;\r\n    });\r\n\r\n    const unique = [\r\n      ...new Map(\r\n        addedProduct.map((item) => [item[\"product_id\"], item])\r\n      ).values(),\r\n    ];\r\n\r\n    cartRef.current = unique;\r\n\r\n    setHasLoaded(true);\r\n  }, [addedProduct, cartRef]);\r\n\r\n  return (\r\n    <Container className={styles.cartContainer}>\r\n      <div className=\"py-5 text-center\">\r\n        <img\r\n          className=\"d-block mx-auto mb-5\"\r\n          src=\"https://image.flaticon.com/icons/png/512/3594/3594363.png\"\r\n          alt=\"\"\r\n          width=\"72\"\r\n          height=\"72\"\r\n        />\r\n        <h2>Carrito de Compras</h2>\r\n        <p className=\"lead\">\r\n          Para proceder con su compra verifique sus datos y complete los campos\r\n          vacios. Recibirá un correo cuando su pedido haya sido aprobado.\r\n        </p>\r\n      </div>\r\n\r\n      <div className=\"row\">\r\n        {alert ? (\r\n          <Alert variant={alertVariant} className=\"w-100 mx-auto\">\r\n            {alertMsg}\r\n          </Alert>\r\n        ) : null}\r\n        <div className=\"col-md-4 order-md-2 mb-4\">\r\n          <h4 className=\"d-flex justify-content-between align-items-center mb-3\">\r\n            <span className=\"text-muted\">Carrito</span>\r\n            <span className=\"badge badge-secondary badge-pill\">{cart}</span>\r\n          </h4>\r\n          <ul className=\"list-group mb-3\">\r\n            {hasLoaded\r\n              ? cartRef.current.map((product) => {\r\n                  return (\r\n                    <li\r\n                      key={product.product_id}\r\n                      className=\"list-group-item d-flex justify-content-between align-items-center flex-wrap lh-condensed\"\r\n                    >\r\n                      <div className={styles.productCont}>\r\n                        <div className={styles.productInfo}>\r\n                          <h6 className=\"my-0\">{product.name}</h6>\r\n                          <small className=\"text-muted\">\r\n                            {product.descripcion}\r\n                          </small>\r\n                        </div>\r\n                        <div className={styles.imgCont}>\r\n                          <img src={`${IMG_URL}${product.img}`} alt=\"\" />\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"d-flex flex-column\">\r\n                        <span className=\"text-muted\">\r\n                          ${product.totalNum * product.price}\r\n                        </span>\r\n                        <span>Cantidad: {product.totalNum}</span>\r\n                        <div className={styles.buttons}>\r\n                          <button\r\n                            className=\"btn btn-success\"\r\n                            onClick={() =>\r\n                              addProduct(\r\n                                product,\r\n                                cartRef.current.indexOf(product)\r\n                              )\r\n                            }\r\n                          >\r\n                            +\r\n                          </button>\r\n                          <button\r\n                            className=\"btn btn-danger\"\r\n                            onClick={() =>\r\n                              deleteProduct(\r\n                                product,\r\n                                cartRef.current.indexOf(product)\r\n                              )\r\n                            }\r\n                          >\r\n                            -\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    </li>\r\n                  );\r\n                })\r\n              : null}\r\n            <li className=\"list-group-item d-flex justify-content-between\">\r\n              <span>Total</span>\r\n              <strong>{`$${cartTotal}`}</strong>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n        <div className=\"col-md-8 order-md-1\">\r\n          <h4 className=\"mb-3\">Datos del Usuario</h4>\r\n          <form>\r\n            <div className=\"row\">\r\n              <div className=\"col-md-6 mb-3\">\r\n                <label for=\"nombre\">Nombre</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"form-control\"\r\n                  id=\"nombre\"\r\n                  name=\"nombre\"\r\n                  placeholder=\"\"\r\n                  value={userForm.nombre}\r\n                  onChange={handleChange}\r\n                  disabled={userForm.email ? true : false}\r\n                />\r\n              </div>\r\n              <div className=\"col-md-6 mb-3\">\r\n                <label for=\"apellido\">Apellidos</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"form-control\"\r\n                  id=\"apellido\"\r\n                  name=\"apellido\"\r\n                  placeholder=\"\"\r\n                  value={userForm.apellido}\r\n                  onChange={handleChange}\r\n                  disabled={userForm.email ? true : false}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mb-3\">\r\n              <label for=\"telefono\">Teléfono</label>\r\n              <div className=\"input-group\">\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"form-control\"\r\n                  id=\"telefono\"\r\n                  name=\"telefono\"\r\n                  placeholder=\"Ejemplo: 4433609253\"\r\n                  value={userForm.telefono}\r\n                  onChange={handleChange}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mb-3\">\r\n              <label for=\"email\">Email</label>\r\n              <input\r\n                type=\"email\"\r\n                className=\"form-control\"\r\n                id=\"email\"\r\n                name=\"email\"\r\n                placeholder=\"usuario@ejemplo.com\"\r\n                value={userForm.email}\r\n                onChange={handleChange}\r\n                disabled={userForm.email ? true : false}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"mb-3\">\r\n              <label for=\"direccion\">Dirección</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"form-control\"\r\n                id=\"direccion\"\r\n                name=\"direccion\"\r\n                placeholder=\"Dirección\"\r\n                value={userForm.direccion}\r\n                onChange={handleChange}\r\n              />\r\n            </div>\r\n            <div class=\"mb-3\">\r\n              <label for=\"codigoPostal\">Código Postal</label>\r\n              <input\r\n                type=\"text\"\r\n                class=\"form-control\"\r\n                id=\"codigoPostal\"\r\n                name=\"codigoPostal\"\r\n                placeholder=\"Código Postal\"\r\n                value={userForm.codigoPostal}\r\n                onChange={handleChange}\r\n              />\r\n            </div>\r\n            <hr class=\"mb-4\" />\r\n            <button\r\n              class=\"btn btn-primary btn-lg btn-block\"\r\n              onClick={handleSubmit}\r\n            >\r\n              Realizar Pedido\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default CartPage;\r\n"]},"metadata":{},"sourceType":"module"}